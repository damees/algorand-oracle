# algorand-oracle
This is an implementation of an Oracle to provide off-chain data to smart contracts running on the Algorand blockchain

[algorand-oracle-smart-contracts](./algorand-oracle-smart-contracts) is an IntelliJ project for Pyteal contracts written using [AlgoDea plugin](https://plugins.jetbrains.com/plugin/15300-algodea-algorand-integration).
The Pyteal contracts have already been compiled to .teal files in the `generated-src/` folder. You can use [Algorand Sandbox](https://github.com/algorand/sandbox) to deploy them. Please, follow the guide on [Algorand Solutions portal](https://developer.algorand.org/solutions/oracle-for-algorand-smart-sontracts#deployment-with-intellij-algodea-plugin) for a step by step guide on how to use AlgoDea plugin to deploy and call the smart contracts.
If you use other tools, please make sure to follow the steps below if you want to test the full solution:

* Create 3 accounts and fund them with some ALGO. We will call them `OracleAdmin`, `Client` and `CallbackAdmin`.
* Update `algorand_oracle.py` and replace the value of the variable `REQUESTS_SELLER` by the address of `OracleAdmin`
* Use the `OracleAdmin` account to deploy the  `algorand_oracle.py` contract. We will consider that the deployed contract has application id 10.
* Use the `CallbackAdmin` account to deploy the  `algorand_oracle_callback.py` contract. We will consider that the deployed contract has application id 20.
* Make the `Client` account `OptIn` application 10.
* Make the `OracleAdmin` account `OptIn` application 20.
* Our contracts requires accounts to be whitelisted after OptIn, before being able to call them.
* Use `OracleAdmin` account to send a call to application id 10 to whitelist account `Client`. The transaction must include 2 application arguments. The first one is the String "whitelist" and the second one is the address of account `Client`.
* Do the same but this time use `CallbackAdmin` account to call application id 20 to whitelist `OracleAdmin` account. This will allow the Java application to use `OracleAdmin` account to send back the requested value.
* Call the `allocate_requests` function using the `OracleAdmin` account to grant some requests credit to the `Client` account. Simply perform a `NoOp` call to the deployed `algorand_oracle.py` contract with the following argument: "allocate_requests", 100, `client account address` and account `Client` to grant for example 100 requests to the `Client` account
* You can also use the `buy_requests` feature which requires account `Client` to send an atomic transfer with 2 transactions in the following order:
  * 1 payment of 10 <= amount <= 1000 ALGO to the `OracleAdmin` address
  * 1 `NoOp` call to the deployed `algorand_oracle.py` contract with arguments: "buy_requests", `client account address` and account `Client`
* `Client` account has now enough credit to send a request to our oracle.
* Send a `NoOp` call to the deployed `algorand_oracle.py` from the `Client` account with arguments: 
  * "get_market_exchange_rate", "EUR/USD", `id of the algorand_oracle_callback.py contract`, "get_market_exchange_rate_callback". 
  * **Add the note** `algo-oracle-app-4` to the transaction. You can personalize the note in the `algorand_oracle.py` contract, but you will have to also update [OracleRequestsLoader.java](./algorand-oracle-requests-processor/src/main/java/com/example/algorand/oracle/requestsprocessor/application/OracleRequestsLoader.java)
* Your are done with the smart contract. Now you need to run the Java Application, which will fetch the previous transaction from the indexer and callback the deployed `algorand_oracle_callback.py` contract.


[algorand-oracle-requests-processor](./algorand-oracle-requests-processor) is a Java Spring Boot project using maven for the build.
To run the application outside IntelliJ, please make sure you have Java 8 and Maven 3 installed.

```
cd algorand-oracle-requests-processor
mvn clean package
cd target
java -Dalgorand.account.oracle.callback.mnemonic="insert mnemonic for OracleAdmin account here" -Dalgorand.contract.oracle.id=sc_id jar algorand-oracle-requests-processor-0.0.1-SNAPSHOT.jar
```
The value `sc_id` should be replaced by the application id generated by the deployment of [algorand_oracle](./algorand-oracle-smart-contracts/src/algorand-oracle.py) smart contract
## Disclaimer
This project has not been audited and should not be used in production environment
